<?xml version="1.0" encoding="UTF-8"?>
<configuration status="INFO">
<!-- 로그레벨 OFF > FATAL > ERROR > WARN > INFO > DEBUG > TRACE > ALL -->
 
<!--  
%m: 로그 내용 출력
%p: debug, info, warn, error, fatal 등의 priority 출력
%r: 어플이 시작 후 이벤트가 발생하는 시점까지의 경과시간 밀리세컨드로 출력
%c: package 출력
%c{n}: n(숫자) 만큼의 package를 가장 하단 부터 역으로 출력
예) %c{2} 일때 a.b.c 는 b.c 로 출력된다.
%n: 개행문자 출력. 플렛폼에 따라 \r\n 또는 \n 출력.
%d: 이벤트 발생 날짜 출력 ( 프로그램의 실행속도를 느리게 한다.)
예) %d{HH:mm:ss} 또는 %d{dd MMMM yyyy HH:mm:ss}
%C: 호출자의 클래스명 출력
예) %C{2} 일때 a.b.c.TestClass 는 c.TestClass 로 출력된다.
%M: method 이름.
%F: 프로그램 파일명.
%l: caller의 정보
%L: caller의 라인수
%x: thread와 관련된 NDC(nested diagnostic context)
%X: thread와 관련된 MDC(mapped diagnostic context)
%%: % 표시를 출력
%t: 쓰레드 이름
-->
 
    <appenders>
        <!-- 일반 콘솔 로그 -->
        <console name="Console" target="SYSTEM_OUT">
            <PatternLayout pattern="%5p %d{yyyy-MM-dd HH:mm:ss,SSS} [%C{2}.%M] %m%n"/>
        </console>
        
		<!-- log4jdbc 전용 콘솔 (Connection.prepareStatement(...)만 출력) -->
		<Console name="SpyConsole" target="SYSTEM_OUT">
		    <PatternLayout pattern="%5p %d{yyyy-MM-dd HH:mm:ss,SSS} [%C{2}.%M] %m%n"/>
		
		    <!-- 여기서 필터링: Connection.prepareStatement( 가 있는 로그만 ACCEPT -->
<!--		    <RegexFilter regex=".*Connection\.prepareStatement\(" -->
<!--		                 onMatch="ACCEPT" -->
<!--		                 onMismatch="DENY"/>-->
		</Console>        

        <!-- SQL 전용 콘솔 로그 (SQL만 깔끔하게 보고 싶을 때) -->
        <console name="SqlConsole" target="SYSTEM_OUT">
            <!-- 위/아래 빈 줄 + 메시지(=SQL)만 출력 -->
            <PatternLayout pattern="%n%n%m%n%n"/>
        </console>

        <!-- 일반 파일 로그 -->
        <RollingFile name="File">
            <FileName>C:/log/MPX/MPX.log</FileName>
            <FilePattern>C:/log/MPX/MPX_%d{yyyy-MM-dd-HH-mm}.log</FilePattern>
            <PatternLayout>
                <Pattern>%5p %d{yyyy-MM-dd HH:mm:ss,SSS} [%C{2}.%M] %m%n</Pattern>
            </PatternLayout>
            <Policies>
                 <SizeBasedTriggeringPolicy size="100MB"/> 
            </Policies>
            <DefaultRolloverStrategy max="5"/>
        </RollingFile>

        <!-- 에러 전용 파일 (원하면 유지, 아니면 삭제) -->
        <RollingFile name="ErrorFile">
            <FileName>C:/log/mylog_error.txt</FileName>
            <FilePattern>C:/log/%d{yyyy-MM-dd-HH-mm}/mylog_error.zip</FilePattern>
            <PatternLayout>
                <Pattern>%d{yyyy-MM-dd HH:mm:ss} %5p [%c] %m%n</Pattern>
            </PatternLayout>
            <Policies>
                 <SizeBasedTriggeringPolicy size="100MB"/> 
            </Policies>
        </RollingFile>
    </appenders>
    
	 <!-- SQL Logger -->
	<loggers>	 
		<!-- log4jdbc: SpyConsole로만 출력, 나머지 상위(root)로는 안 올림 -->
		<Logger name="log4jdbc" level="INFO" additivity="false">
		    <AppenderRef ref="SpyConsole"/>
		</Logger>

        <!-- SQL + 실행 시간(ms) 로그 -->
        <logger name="jdbc.sqltiming" level="OFF" additivity="false">
            <AppenderRef ref="SqlConsole"/>
            <!-- <AppenderRef ref="File"/> -->
        </logger>

        <!-- 순수 SQL 문장 로그 -->
        <logger name="jdbc.sqlonly" level="OFF" additivity="false">
            <AppenderRef ref="SqlConsole"/>
            <!-- <AppenderRef ref="File"/> -->
        </logger>
		
        <root level="INFO">
           	<appenderRef ref="console"/>
           	<AppenderRef ref="RollingFile"/>
        </root>		
	</loggers>
</configuration>
