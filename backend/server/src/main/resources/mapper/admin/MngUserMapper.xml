<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mpx.minipx.mapper.MngUserMapper">

	<!-- 사용자 목록 조회 -->
	<select id="getMngUserList" parameterType="map" resultType="camelCaseMap">
		SELECT T1.USER_SEQ                               /*사용자일련번호*/
			 , T1.USER_ID                                /*사용자아이디*/
			 , T1.USER_NM                                /*사용자명*/
			 , T1.AI_OPEN_YN                             /*AI사용여부*/
			 , T1.CREDIT                                 /*크레딧*/
			 , T1.USE_YN                       			 /*사용여부*/
			 , T1.RMRK                                   /*비고*/
			 , T1.PW_CH_DTTI                             /*비밀번호최종수정일시*/
			 , T1.PW_BF                                  /*이전 비밀번호*/
			 , T1.PW_ERR_CNT                             /*비밀번호 오입력 횟수*/
			 , T1.PW_INIT_YN                             /*비밀번호 초기화 여부*/
			 , T1.ROLE_SEQ                               /*권한그룹일련번호*/
			 , T1.FST_REG_SEQ                            /*최초등록자일련번호*/
			 , T1.FST_REG_DTTI                           /*최초등록일시*/
			 , T1.LST_UPD_SEQ                            /*최종수정자일련번호*/
			 , T1.LST_UPD_DTTI                           /*최종수정일시*/
		  FROM tb_user T1								 /*테이블_사용자*/ 
		 WHERE 1 = 1
		 <if test='searchKeyword != null and searchKeyword != ""'>
		   AND 	( T1.USER_ID LIKE CONCAT('%', #{searchKeyword}, '%')
		   	   OR T1.USER_NM LIKE CONCAT('%', #{searchKeyword}, '%')
		   	   	)
		 </if>	 
		 ORDER BY T1.USER_NM
	</select>	
	
	<!--중복 아이디 숫자 검증-->
	<select id="countUserId" parameterType="map" resultType="camelCaseMap">
		SELECT COUNT(*) AS CNT
		  FROM tb_user T1								 /*테이블_사용자*/ 
		 WHERE T1.USER_SEQ != #{userSeq}
		   AND T1.USER_ID = #{userId}
	</select>		
	
	<!-- 사용자 생성 -->
	<insert id="insertUser" parameterType="map">
		INSERT INTO tb_user                /*테이블_사용자*/ 
		     ( USER_ID                     /*사용자아이디*/
		     , USER_PW                     /*사용자비밀번호*/
		     , USER_NM                     /*사용자명*/
		     , ROLE_SEQ                    /*권한그룹일련번호*/
		     , FST_REG_SEQ                 /*최초등록자일련번호*/    
		     , FST_REG_DTTI                /*최초등록일시*/       
		     , LST_UPD_SEQ                 /*최종수정자일련번호*/    
		     , LST_UPD_DTTI                /*최종수정일시*/       
			 ) 
		VALUES 
			 ( CONCAT('NEW', REPLACE(UUID(), '-', ''))
		     , #{userPw}
		     , '신규 사용자'
		     , 1
			 , #{loginUserSeq}             /*최초등록자일련번호*/                    
			 , NOW()                       /*최초등록일시*/                       
			 , #{loginUserSeq}             /*최종수정자일련번호*/                    
			 , NOW()                       /*최종수정일시*/ 		    
			 )
	</insert>		
	
	
	<!-- 사용자 수정 -->
	<update id="updateUser" parameterType="map">
	    UPDATE tb_user
	       SET USER_ID				= #{userId}
	       	 , USER_NM              = #{userNm}
			 , AI_OPEN_YN 			= #{aiOpenYn}
			 , CREDIT               = #{credit}
			 , USE_YN               = #{useYn}
	         , LST_UPD_SEQ 			= #{loginUserSeq}
	         , LST_UPD_DTTI 		= NOW()
	     WHERE USER_SEQ				= #{userSeq}
	</update>		
</mapper>