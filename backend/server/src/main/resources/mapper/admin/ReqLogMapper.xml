<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mpx.minipx.mapper.ReqLogMapper">

	<!-- 요청 로그 목록 조회 -->
	<select id="getReqLogList" parameterType="map" resultType="camelCaseMap">
		SELECT T1.REQ_SEQ                                /*요청일련번호*/
			 , DATE_FORMAT(T1.REQ_DTTI, '%Y-%m-%d %H:%i:%s') AS REQ_DTTI   /*요청일시*/
			 , T1.USER_SEQ                               /*사용자일련번호*/
			 , T1.IP                                     /*사용자아이피*/
			 , T1.URI                                    /*요청경로*/
			 , T1.PARAM                                  /*요청파라미터*/
			 , T1.REQ_TYPE_CODE                          /*요청타입코드*/
		  FROM tb_log_req T1							 /*테이블_요청로그*/ 
		 WHERE 1 = 1
		 <if test='startDate != null and startDate != "" and endDate != null and endDate != ""'>
		   AND DATE_FORMAT(T1.REQ_DTTI, '%Y%m%d') BETWEEN DATE_FORMAT(#{startDate}, '%Y%m%d') AND DATE_FORMAT(#{endDate}, '%Y%m%d') 
		 </if>			 
		 <if test='reqTypeCode != null and reqTypeCode != ""'>
		   AND REQ_TYPE_CODE = #{reqTypeCode}
		 </if>			 
		 <if test='searchKeyword != null and searchKeyword != ""'>
		   AND 	( T1.URI LIKE CONCAT('%', #{searchKeyword}, '%')
		   	   OR T1.IP LIKE CONCAT('%', #{searchKeyword}, '%')
		   	   	)
		 </if>	 
		 ORDER BY T1.REQ_DTTI DESC
		 LIMIT #{pageSize} OFFSET #{offset}
	</select>	
	
	<!-- 요청 로그 목록 조회(전체 건수) -->
	<select id="getReqLogListCount" parameterType="map" resultType="int">
	    SELECT COUNT(1)
	      FROM tb_log_req T1
	     WHERE 1 = 1
		 <if test='startDate != null and startDate != "" and endDate != null and endDate != ""'>
		   AND DATE_FORMAT(T1.REQ_DTTI, '%Y%m%d') BETWEEN DATE_FORMAT(#{startDate}, '%Y%m%d') AND DATE_FORMAT(#{endDate}, '%Y%m%d') 
		 </if>			 
		 <if test='reqTypeCode != null and reqTypeCode != ""'>
		   AND REQ_TYPE_CODE = #{reqTypeCode}
		 </if>			 
		 <if test='searchKeyword != null and searchKeyword != ""'>
		   AND 	( T1.URI LIKE CONCAT('%', #{searchKeyword}, '%')
		   	   OR T1.IP LIKE CONCAT('%', #{searchKeyword}, '%')
		   	   	)
		 </if>	 
	</select>	
</mapper>