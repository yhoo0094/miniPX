<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mpx.minipx.mapper.ManualMapper">

  <!-- ==========================================================
      MANUAL  (사용자)
      - 사용 매뉴얼 목록(아코디언)
      - 검색: 구분 + 제목/내용
      ========================================================== -->

  <!-- ==========================================================
      매뉴얼 목록 COUNT
      ========================================================== -->
  <select id="getManualListCount" parameterType="map" resultType="int">
    /*getManualListCount*/
    SELECT
          COUNT(1) AS CNT
      FROM tb_manual M
     WHERE 1 = 1

       <!-- 사용여부 -->
       <if test="useYn != null and useYn != ''">
       AND M.USE_YN = #{useYn}
       </if>

       <!-- 구분(01:마켓, 02:정보, 03:AI, 99:기타) -->
       <if test="manualDvcd != null and manualDvcd != ''">
       AND M.MANUAL_DVCD = #{manualDvcd}
       </if>

       <!-- 제목/내용 검색 -->
       <if test="searchKeyword != null and searchKeyword != ''">
       AND (
              M.MANUAL_TITLE   LIKE CONCAT('%', #{searchKeyword}, '%')
           OR M.MANUAL_CONTENT LIKE CONCAT('%', #{searchKeyword}, '%')
           )
       </if>
  </select>


  <!-- ==========================================================
      매뉴얼 목록 조회
      - 화면(아코디언): [구분] 제목 / (펼침) 내용
      ========================================================== -->
  <select id="getManualList" parameterType="map" resultType="map">
    /*getManualList*/
    SELECT
          M.MANUAL_SEQ     AS manualSeq
        , M.MANUAL_TITLE   AS manualTitle
        , M.MANUAL_CONTENT AS manualContent
        , M.MANUAL_DVCD    AS manualDvcd
        , M.USE_YN         AS useYn
        , M.FST_REG_SEQ    AS fstRegSeq
        , DATE_FORMAT(M.FST_REG_DTTI, '%Y-%m-%d %H:%i:%s') AS fstRegDtti
        , M.LST_UPD_SEQ    AS lstUpdSeq
        , DATE_FORMAT(M.LST_UPD_DTTI, '%Y-%m-%d %H:%i:%s') AS lstUpdDtti
      FROM tb_manual M
     WHERE 1 = 1

       <!-- 사용여부 -->
       <if test="useYn != null and useYn != ''">
       AND M.USE_YN = #{useYn}
       </if>

       <!-- 구분(01:마켓, 02:정보, 03:AI, 99:기타) -->
       <if test="manualDvcd != null and manualDvcd != ''">
       AND M.MANUAL_DVCD = #{manualDvcd}
       </if>

       <!-- 제목/내용 검색 -->
       <if test="searchKeyword != null and searchKeyword != ''">
       AND (
              M.MANUAL_TITLE   LIKE CONCAT('%', #{searchKeyword}, '%')
           OR M.MANUAL_CONTENT LIKE CONCAT('%', #{searchKeyword}, '%')
           )
       </if>

     ORDER BY M.MANUAL_DVCD ASC, M.MANUAL_TITLE ASC, M.MANUAL_SEQ DESC
     <if test="pageSize != null and pageSize != 0">
     LIMIT #{pageSize}
    OFFSET #{offset}
     </if>
  </select>

</mapper>
