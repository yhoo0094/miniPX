<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mpx.minipx.mapper.ItemNewMapper">

	<!-- 주문 목록 조회 -->
	<select id="getNewOrder" parameterType="map" resultType="camelCaseMap">	
		SELECT T1.NEW_ORDER_SEQ				/*신규상품주문일련번호*/
			 , T1.USER_SEQ                  /*사용자일련번호*/
			 , T1.ITEM_NM					/*상품명*/
			 , T1.IMG                       /*이미지*/
			 , T1.PRICE                     /*가격*/
			 , T1.CNT                       /*개수*/
			 , T1.NEW_ORDER_DTL             /*신규상품주문상세*/
			 , T1.ORDER_STATUS_CODE         /*주문상태코드(01:구매요청, 02:배송중, 03:미결제, 04:송금완료, 11:구매완료, 12:품절, 91:취소)*/    
			 , (SELECT CODE_DETAIL_NM FROM tb_code_detail WHERE CODE_GROUP = 'ORDER_STATUS_CODE' AND CODE_DETAIL = T1.ORDER_STATUS_CODE) ORDER_STATUS_CODE_NM  /*주문상태코드명*/
			 , DATE_FORMAT(T1.ORDER_DTTI, '%Y-%m-%d %H:%i:%s') AS ORDER_DTTI	/*주문일시*/
			 , T1.ORDER_STATUS_DTL          /*주문상태상세*/
			 , T1.FST_REG_SEQ               /*최초등록자일련번호*/
			 , T1.FST_REG_DTTI              /*최초등록일시*/
			 , T1.LST_UPD_SEQ               /*최종수정자일련번호*/
			 , T1.LST_UPD_DTTI              /*최종수정일시*/
		  FROM tb_new_order T1				/*테이블_신규상품주문*/
		 WHERE T1.NEW_ORDER_SEQ = #{newOrderSeq}
	</select>		
	
	<!-- 신규상품주문 이미지 조회 -->
	<select id="getItemNewImage" parameterType="long" resultType="string">
		SELECT T1.IMG                       	/*이미지*/
		  FROM tb_new_order T1					/*테이블_신규상품주문*/
		 WHERE T1.NEW_ORDER_SEQ =  #{orderSeq}	/*신규상품주문일련번호*/
	</select>			 

	<!-- 신규상품주문 등록 -->
	<insert id="insertNewOrder" parameterType="map" useGeneratedKeys="true" keyProperty="newOrderSeq">
	    INSERT INTO tb_new_order                   
	    	 ( USER_SEQ                            /*사용자일련번호*/             
			 , ITEM_NM                             /*상품명*/                 
			 , IMG                                 /*이미지*/                 
			 , PRICE                               /*가격*/                  
			 , CNT                                 /*개수*/                  
			 , NEW_ORDER_DTL                       /*신규상품주문상세*/            
			 , ORDER_STATUS_CODE                   /*주문상태코드*/              
			 , ORDER_DTTI                          /*주문일시*/                
			 , ORDER_STATUS_DTL                    /*주문상태상세*/              
			 , FST_REG_SEQ                         /*최초등록자일련번호*/           
			 , FST_REG_DTTI                        /*최초등록일시*/              
			 , LST_UPD_SEQ                         /*최종수정자일련번호*/           
			 , LST_UPD_DTTI                        /*최종수정일시*/              
			 ) 
		VALUES	  
			 ( #{userSeq}                          /*사용자일련번호*/                     
			 , #{itemNm}                           /*상품명*/                         
			 , #{img}                              /*이미지*/                         
			 , 0                            	   /*가격*/                          
			 , #{cnt}                              /*개수*/                          
			 , #{newOrderDtl}                      /*신규상품주문상세*/                    
			 , '01'                  			   /*주문상태코드*/                      
			 , NOW()                        	   /*주문일시*/                        
			 , #{orderStatusDtl}                   /*주문상태상세*/                      
			 , #{userSeq}                          /*최초등록자일련번호*/                    
			 , NOW()                               /*최초등록일시*/                       
			 , #{userSeq}                          /*최종수정자일련번호*/                    
			 , NOW()                               /*최종수정일시*/                    
			 )
	</insert>		
	
	<!-- 신규상품주문 수정 -->
	<update id="updateNewOrder" parameterType="map">
	    UPDATE tb_new_order
	       SET ITEM_NM    			= #{itemNm}
		 <if test='img != null and img != ""'>
		     , IMG                  = #{img}                            /*이미지*/
		 </if>			         
			 , CNT 					= #{cnt}
			 , NEW_ORDER_DTL		= #{newOrderDtl}
	         , LST_UPD_SEQ 			= #{userSeq}
	         , LST_UPD_DTTI 		= NOW()
	     WHERE NEW_ORDER_SEQ   		= #{newOrderSeq}		   
	</update>
</mapper>